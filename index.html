<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natural Codebook Quantization - Emotion Research</title>
    <link rel="stylesheet" href="docs/css/style.css">
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">Emotion Quantization</a>
            <div class="nav-links">
                <a href="index.html" class="active">Natural Codebook</a>
                <a href="emotion_cross.html">Emotion Cross</a>
            </div>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1>Natural Codebook Quantization</h1>
            <p>Listen to how emotional expression changes as quantization intensity (λ) increases. 
               As λ grows, emotions gradually neutralize.</p>
        </div>
    </header>

    <main>
        <!-- Reference Audio Section -->
        <section class="section section-dark">
            <div class="container">
                <h2 class="section-title">Reference Audio (Input)</h2>
                <p style="text-align: center; margin-bottom: var(--space-lg); color: var(--text-secondary);">
                    These are the original reference audio samples used for all experiments below.
                </p>
                <div id="referenceAudio" class="audio-grid"></div>
            </div>
        </section>

        <!-- Generated Audio Section -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">Generated Audio (Output)</h2>
                <h3>Select Quantization Level</h3>
                <div class="lambda-selector" id="lambdaSelector">
                    <button class="lambda-btn active" data-lambda="original">Original</button>
                    <button class="lambda-btn" data-lambda="lambda_0">λ = 0</button>
                    <button class="lambda-btn" data-lambda="lambda_1">λ = 1</button>
                    <button class="lambda-btn" data-lambda="lambda_10">λ = 10</button>
                    <button class="lambda-btn" data-lambda="lambda_50">λ = 50</button>
                    <button class="lambda-btn" data-lambda="lambda_100">λ = 100</button>
                    <button class="lambda-btn" data-lambda="lambda_200">λ = 200</button>
                    <button class="lambda-btn" data-lambda="lambda_500">λ = 500</button>
                </div>

                <div id="audioContainer" class="audio-grid"></div>
            </div>
        </section>

        <section class="section section-dark">
            <div class="container">
                <h2 class="section-title">Quantization Statistics</h2>
                <div class="comparison-container">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Lambda (λ)</th>
                                <th>Avg. Bits per Frame</th>
                                <th>Skip Rate (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>0</td><td>62.31</td><td>51.96%</td></tr>
                            <tr><td>1</td><td>39.23</td><td>3.44%</td></tr>
                            <tr><td>10</td><td>30.39</td><td>23.91%</td></tr>
                            <tr><td>50</td><td>25.06</td><td>31.47%</td></tr>
                            <tr><td>100</td><td>19.96</td><td>31.43%</td></tr>
                            <tr><td>200</td><td>18.48</td><td>23.27%</td></tr>
                            <tr><td>500</td><td>18.37</td><td>22.22%</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Audio samples generated using GPT-SoVITS with emotion2vec embeddings</p>
        </div>
    </footer>

    <script>
        const emotions = ['Angry', 'Happy', 'Neutral', 'Sad', 'Surprise'];
        const speakers = ['0005', '0013', '0018'];
        const basePath = 'natural_codebook_experiment/natural_codebook_infer_20260111_182854/';
        
        // Generate Reference Audio HTML
        function generateReferenceHTML() {
            let html = '';
            
            emotions.forEach(emotion => {
                html += `
                    <div class="audio-section">
                        <div class="audio-section-header">
                            <h3>${emotion}</h3>
                            <span class="lambda-badge">Reference</span>
                        </div>
                        <div class="audio-samples">
                `;
                
                speakers.forEach(speaker => {
                    const filename = `original/reference/${speaker}_${emotion}_ref.wav`;
                    
                    html += `
                        <div class="audio-card">
                            <div class="audio-label">
                                <span>Speaker ${speaker}</span>
                                <span class="emotion-tag ${emotion.toLowerCase()}">${emotion}</span>
                            </div>
                            <audio controls preload="none">
                                <source src="${basePath}${filename}" type="audio/wav">
                            </audio>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            return html;
        }
        
        // Generate Generated Audio HTML
        function generateAudioHTML(lambda) {
            let html = '';
            
            emotions.forEach(emotion => {
                html += `
                    <div class="audio-section">
                        <div class="audio-section-header">
                            <h3>${emotion}</h3>
                            <span class="lambda-badge">${lambda === 'original' ? 'No Quantization' : lambda.replace('_', ' = ')}</span>
                        </div>
                        <div class="audio-samples">
                `;
                
                speakers.forEach(speaker => {
                    const filename = `${lambda}/generated/${speaker}_${emotion}.wav`;
                    
                    html += `
                        <div class="audio-card">
                            <div class="audio-label">
                                <span>Speaker ${speaker}</span>
                                <span class="emotion-tag ${emotion.toLowerCase()}">${emotion}</span>
                            </div>
                            <audio controls preload="none">
                                <source src="${basePath}${filename}" type="audio/wav">
                            </audio>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            return html;
        }
        
        function updateAudioDisplay(lambda) {
            document.getElementById('audioContainer').innerHTML = generateAudioHTML(lambda);
        }
        
        document.querySelectorAll('.lambda-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.lambda-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                updateAudioDisplay(this.dataset.lambda);
            });
        });
        
        // Initialize
        document.getElementById('referenceAudio').innerHTML = generateReferenceHTML();
        updateAudioDisplay('original');
    </script>
</body>
</html>
